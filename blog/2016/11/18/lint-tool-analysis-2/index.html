<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>
       Lint Tool Analysis (2) &middot;  Hujiawei Bujidao
    </title>

    <meta name="generator" content="Hugo 0.67.0" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta property="og:title" content=" Lint Tool Analysis (2) &middot;  Hujiawei Bujidao" />
  	<meta property="og:site_name" content="Hujiawei Bujidao" />
  	<meta property="og:url" content="https://hujiaweibujidao.github.io/blog/2016/11/18/lint-tool-analysis-2/" />

    
  	<meta property="og:type" content="article" />
    <meta property="og:article:published_time" content="2016-11-18T10:46:33&#43;08:00" />
    
    <meta property="og:article:tag" content="android" />
    
    

    <meta name="description" content="Happy Coding &amp; Enjoy Living" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://hujiaweibujidao.github.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://hujiaweibujidao.github.io/images/apple-touch-icon.png" />
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/hugo.css" />

    
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/highlight.css">
    
    <link rel="stylesheet" type="text/css" href="https://hujiaweibujidao.github.io/css/github-gist.css">
    
    <script src="https://hujiaweibujidao.github.io/js/highlight.js"></script>
    <script type="text/javascript">hljs.initHighlightingOnLoad();</script>

    
    

    

    <link rel="canonical" href="https://hujiaweibujidao.github.io/blog/2016/11/18/lint-tool-analysis-2/" />

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://hujiaweibujidao.github.io/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://hujiaweibujidao.github.io/about">About</a>
            </li>
        

        <li class="nav-opened" role="presentation"><a href=""></a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/algorithm/">tags/algorithm</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/android/">tags/android</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/swift/">tags/swift</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/reactnative/">tags/reactnative</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/python/">tags/python</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/java/">tags/java</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/dev/">tags/dev</a></li>
        <li class="nav-opened" role="presentation"><a href="https://hujiaweibujidao.github.io/tags/life/">tags/life</a></li>
    </ul>

    
    

    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




  <header class="main-header post-head" style="background-image: url(https://www.bing.com/ImageResolution.aspx?w=1366&amp;h=768)">
  

    <nav class="main-nav overlay clearfix">
    
        
    
    
        <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
    
</nav>

    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title">Lint Tool Analysis (2)</h1>
            <h2 class="page-description">Hujiawei Bujidao</h2> <br/>
            
    <a class="bloglogo" href="https://github.com/hujiaweibujidao" target="_blank">
    <span class="icon-github" style="color:white;font-size:2em"></span>
    </a>
&nbsp;


    <a class="bloglogo" href="https://weibo.com/hujiaweiyinger" target="_blank">
        <span class="icon-twitter" style="color:white;font-size:2em"></span>
    </a>
&nbsp;




    <a class="bloglogo" href="https://www.linkedin.com/in/hujiaweibujidao" target="_blank">
        <span class="icon-linkedin" style="color:white;font-size:2em"></span>
    </a>
&nbsp;


        </div>
    </div>
</header>



<main class="content" role="main">
  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Lint Tool Analysis (2)</h1>
        

        <section class="post-meta">
        
          <span class="post-tag small"><a href="https://hujiaweibujidao.github.io/tags/android/">#android</a></span>
        
        &nbsp;&nbsp;
        
          <time class="post-date" datetime="2016-11-18T10:46:33&#43;08:00">
            2016/11/18
          </time>
        
        </section>
        <br/>
    </header>

    <section class="post-content">
      <p>Lint工具的源码分析(2)</p>
<p><strong>本系列的几篇源码分析文档意义不大，如果你正好也在研究lint源码，或者你想知道前面自定义lint规则中提出的那几个问题，抑或你只是想大致了解下lint的源码都有些什么内容的话，这些文章可能有还些作用，否则看了和没看差不多的，因为这几篇文章只是我在读源码的过程中记录下来的一些零碎的片段，方便以后看的时候能够迅速上手。</strong></p>
<p>继续上一篇的解析，本篇我们来详细分析下<code>client.api</code>包中的重要类。</p>
<h3 id="2-clientapi包中的重要类">2. client.api包中的重要类</h3>
<p>(1) <code>LintClient</code>类是指调用lint检查的来源(客户端)，可能是在Android Studio中或者在gradle中，也可能是在终端通过命令行的形式来调用。<code>LintClient</code>只是一个抽象类，主要实现类有<code>IntellijLintClient</code>，顾名思义它是指在Intellij(Android Studio)中执行lint，它还有两个子类，分别是批量进行lint检查的<code>BatchLintClient</code>和针对当前编辑器中单个文件执行lint检查的<code>EditorLintClient</code>；另一个实现是<code>LintClientWrapper</code>，这个类定义在<code>LintDriver</code>中，它并没有具体去实现那些方法，而是采用代理模式的形式进行了一层封装，被封装的<code>LintClient</code>可能是<code>IntellijLintClient</code>或者<code>BatchLintClient</code>或者<code>EditorLintClient</code>等。<br>
<strong>通俗来讲，LintClient是指去调用lint检查的来源(客户端)，它会提供执行lint检查的相关环境信息。</strong></p>
<p><code>LintClient</code>中定义了一个值为<code>com.android.tools.lint.bindir</code>的常量，它是作为键值用来指向lint命令所在的目录，获取这个目录的方法是<code>getLintBinDir</code>，它先会去系统属性中查找(用<code>java -jar xxx -Dcom.android.tools.lint.bindir=value</code>的形式设置的)，如果没找到的话会再去系统环境变量中查找，有了这个路径的话可以利用相对路径从而方便去获取其他资源，参见其中的<code>getSdkHome</code>和<code>findResource</code>方法。当我们在终端输入<code>lint</code>命令的时候，lint脚本会自动帮我们设置<code>com.android.tools.lint.bindir</code>的值，这个我们后面分析lint脚本源码的时候可以看到。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Information about the tool embedding the lint analyzer. IDEs and other tools
</span><span style="color:#75715e"> * implementing lint support will extend this to integrate logging, displaying errors,
</span><span style="color:#75715e"> * etc.
</span><span style="color:#75715e"> * &lt;p&gt;
</span><span style="color:#75715e"> * &lt;b&gt;NOTE: This is not a public or final API; if you rely on this be prepared
</span><span style="color:#75715e"> * to adjust your code for the next tools release.&lt;/b&gt;
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LintClient</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String PROP_BIN_DIR  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;com.android.tools.lint.bindir&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">...</span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Returns the File corresponding to the system property or the environment variable
</span><span style="color:#75715e">     * for {@link #PROP_BIN_DIR}.
</span><span style="color:#75715e">     * This property is typically set by the SDK/tools/lint[.bat] wrapper.
</span><span style="color:#75715e">     * It denotes the path of the wrapper on disk.
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @return A new File corresponding to {@link LintClient#PROP_BIN_DIR} or null.
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Nullable</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> File <span style="color:#a6e22e">getLintBinDir</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// First check the Java properties (e.g. set using &#34;java -jar ... -Dname=value&#34;)
</span><span style="color:#75715e"></span>        String path <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">getProperty</span><span style="color:#f92672">(</span>PROP_BIN_DIR<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>path <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> path<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// If not found, check environment variables.
</span><span style="color:#75715e"></span>            path <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">getenv</span><span style="color:#f92672">(</span>PROP_BIN_DIR<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>path <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>path<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            File file <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>path<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>file<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span> file<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#f92672">...</span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Returns the File pointing to the user&#39;s SDK install area. This is generally
</span><span style="color:#75715e">     * the root directory containing the lint tool (but also platforms/ etc).
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @return a file pointing to the user&#39;s install area
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Nullable</span>
    <span style="color:#66d9ef">public</span> File <span style="color:#a6e22e">getSdkHome</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        File binDir <span style="color:#f92672">=</span> getLintBinDir<span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>binDir <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">assert</span> binDir<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tools&#34;</span><span style="color:#f92672">);</span>

            File root <span style="color:#f92672">=</span> binDir<span style="color:#f92672">.</span><span style="color:#a6e22e">getParentFile</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>root <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> root<span style="color:#f92672">.</span><span style="color:#a6e22e">isDirectory</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span> root<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        String home <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">getenv</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ANDROID_HOME&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>home <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>home<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Locates an SDK resource (relative to the SDK root directory).
</span><span style="color:#75715e">     * &lt;p&gt;
</span><span style="color:#75715e">     * TODO: Consider switching to a {@link URL} return type instead.
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @param relativePath A relative path (using {@link File#separator} to
</span><span style="color:#75715e">     *            separate path components) to the given resource
</span><span style="color:#75715e">     * @return a {@link File} pointing to the resource, or null if it does not
</span><span style="color:#75715e">     *         exist
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Nullable</span>
    <span style="color:#66d9ef">public</span> File <span style="color:#a6e22e">findResource</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> String relativePath<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        File top <span style="color:#f92672">=</span> getSdkHome<span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>top <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Lint must be invoked with the System property &#34;</span>
                   <span style="color:#f92672">+</span> PROP_BIN_DIR <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; pointing to the ANDROID_SDK tools directory&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        File file <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>top<span style="color:#f92672">,</span> relativePath<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>file<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> file<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>LintClient</code>中定义了5个抽象方法，其中<code>repoort</code>和<code>log</code>方法分别用于在lint过程中向调用者(客户端)反馈发现的问题和打印日志信息，这两个方法经常在检查器<code>Detector</code>中通过<code>Context</code>类对象间接被调用。<code>getXmlParser</code>和<code>getJavaParser</code>方法分别用来返回解析XML文件和解析Java文件的处理类，<code>readFile</code>方法则是用来读取指定的文件内容的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Report the given issue. This method will only be called if the configuration
</span><span style="color:#75715e"> * provided by {@link #getConfiguration(Project,LintDriver)} has reported the corresponding
</span><span style="color:#75715e"> * issue as enabled and has not filtered out the issue with its
</span><span style="color:#75715e"> * {@link Configuration#ignore(Context,Issue,Location,String)} method.
</span><span style="color:#75715e"> * &lt;p&gt;
</span><span style="color:#75715e"> * @param context the context used by the detector when the issue was found
</span><span style="color:#75715e"> * @param issue the issue that was found
</span><span style="color:#75715e"> * @param severity the severity of the issue
</span><span style="color:#75715e"> * @param location the location of the issue
</span><span style="color:#75715e"> * @param message the associated user message
</span><span style="color:#75715e"> * @param format the format of the description and location descriptions
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">report</span><span style="color:#f92672">(</span>
        <span style="color:#a6e22e">@NonNull</span> Context context<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@NonNull</span> Issue issue<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@NonNull</span> Severity severity<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@NonNull</span> Location location<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@NonNull</span> String message<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@NonNull</span> TextFormat format<span style="color:#f92672">);</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Send an exception or error message to the log
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param severity the severity of the warning
</span><span style="color:#75715e"> * @param exception the exception, possibly null
</span><span style="color:#75715e"> * @param format the error message using {@link String#format} syntax, possibly null
</span><span style="color:#75715e"> *    (though in that case the exception should not be null)
</span><span style="color:#75715e"> * @param args any arguments for the format string
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">log</span><span style="color:#f92672">(</span>
        <span style="color:#a6e22e">@NonNull</span> Severity severity<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@Nullable</span> Throwable exception<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@Nullable</span> String format<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@Nullable</span> Object<span style="color:#f92672">...</span> args<span style="color:#f92672">);</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Returns a {@link XmlParser} to use to parse XML
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @return a new {@link XmlParser}, or null if this client does not support
</span><span style="color:#75715e"> *         XML analysis
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Nullable</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> XmlParser <span style="color:#a6e22e">getXmlParser</span><span style="color:#f92672">();</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Returns a {@link JavaParser} to use to parse Java
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param project the project to parse, if known (this can be used to look up
</span><span style="color:#75715e"> *                the class path for type attribution etc, and it can also be used
</span><span style="color:#75715e"> *                to more efficiently process a set of files, for example to
</span><span style="color:#75715e"> *                perform type attribution for multiple units in a single pass)
</span><span style="color:#75715e"> * @return a new {@link JavaParser}, or null if this client does not
</span><span style="color:#75715e"> *         support Java analysis
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Nullable</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> JavaParser <span style="color:#a6e22e">getJavaParser</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Nullable</span> Project project<span style="color:#f92672">);</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Reads the given text file and returns the content as a string
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param file the file to read
</span><span style="color:#75715e"> * @return the string to return, never null (will be empty if there is an
</span><span style="color:#75715e"> *         I/O error)
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@NonNull</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> String <span style="color:#a6e22e">readFile</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> File file<span style="color:#f92672">);</span>
</code></pre></div><p><code>LintClient</code>中还定义了很多内容，比如下面的<code>ClassPathInfo</code>内部类，它用来封装一个Project的各个文件夹，例如源码文件夹，class文件夹，库文件集合等等，以及一个<code>getClassPath</code>的方法去获取<code>ClassPathInfo</code>数据。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Information about class paths (sources, class files and libraries)
</span><span style="color:#75715e"> * usually associated with a project.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClassPathInfo</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> mClassFolders<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> mSourceFolders<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> mLibraries<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> mNonProvidedLibraries<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> mTestFolders<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClassPathInfo</span><span style="color:#f92672">(</span>
            <span style="color:#a6e22e">@NonNull</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> sourceFolders<span style="color:#f92672">,</span>
            <span style="color:#a6e22e">@NonNull</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> classFolders<span style="color:#f92672">,</span>
            <span style="color:#a6e22e">@NonNull</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> libraries<span style="color:#f92672">,</span>
            <span style="color:#a6e22e">@NonNull</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> nonProvidedLibraries<span style="color:#f92672">,</span>
            <span style="color:#a6e22e">@NonNull</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> testFolders<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        mSourceFolders <span style="color:#f92672">=</span> sourceFolders<span style="color:#f92672">;</span>
        mClassFolders <span style="color:#f92672">=</span> classFolders<span style="color:#f92672">;</span>
        mLibraries <span style="color:#f92672">=</span> libraries<span style="color:#f92672">;</span>
        mNonProvidedLibraries <span style="color:#f92672">=</span> nonProvidedLibraries<span style="color:#f92672">;</span>
        mTestFolders <span style="color:#f92672">=</span> testFolders<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@NonNull</span>
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getSourceFolders</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> mSourceFolders<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@NonNull</span>
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getClassFolders</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> mClassFolders<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@NonNull</span>
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getLibraries</span><span style="color:#f92672">(</span><span style="color:#66d9ef">boolean</span> includeProvided<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> includeProvided <span style="color:#f92672">?</span> mLibraries <span style="color:#f92672">:</span> mNonProvidedLibraries<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getTestSourceFolders</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> mTestFolders<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Considers the given project as an Eclipse project and returns class path
</span><span style="color:#75715e"> * information for the project - the source folder(s), the output folder and
</span><span style="color:#75715e"> * any libraries.
</span><span style="color:#75715e"> * &lt;p&gt;
</span><span style="color:#75715e"> * Callers will not cache calls to this method, so if it&#39;s expensive to compute
</span><span style="color:#75715e"> * the classpath info, this method should perform its own caching.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param project the project to look up class path info for
</span><span style="color:#75715e"> * @return a class path info object, never null
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@NonNull</span>
<span style="color:#66d9ef">protected</span> ClassPathInfo <span style="color:#a6e22e">getClassPath</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> Project project<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    ClassPathInfo info<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mProjectInfo <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        mProjectInfo <span style="color:#f92672">=</span> Maps<span style="color:#f92672">.</span><span style="color:#a6e22e">newHashMap</span><span style="color:#f92672">();</span>
        info <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
        info <span style="color:#f92672">=</span> mProjectInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>project<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>info <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> sources <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;(</span>2<span style="color:#f92672">);</span>
        List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> classes <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;(</span>1<span style="color:#f92672">);</span>
        List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> libraries <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;();</span>
        <span style="color:#75715e">// No test folders in Eclipse:
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// https://bugs.eclipse.org/bugs/show_bug.cgi?id=224708
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> tests <span style="color:#f92672">=</span> Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">emptyList</span><span style="color:#f92672">();</span>

        <span style="color:#75715e">//将project视为eclipse的project，那么项目根目录下有个.classpath文件，解析这个文件来获取classpath信息
</span><span style="color:#75715e"></span>        File projectDir <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getDir</span><span style="color:#f92672">();</span>
        File classpathFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>projectDir<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;.classpath&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>classpathFile<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            String classpathXml <span style="color:#f92672">=</span> readFile<span style="color:#f92672">(</span>classpathFile<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                Document document <span style="color:#f92672">=</span> XmlUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">parseDocument</span><span style="color:#f92672">(</span>classpathXml<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
                NodeList tags <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span><span style="color:#a6e22e">getElementsByTagName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;classpathentry&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">,</span> n <span style="color:#f92672">=</span> tags<span style="color:#f92672">.</span><span style="color:#a6e22e">getLength</span><span style="color:#f92672">();</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
                    Element element <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Element<span style="color:#f92672">)</span> tags<span style="color:#f92672">.</span><span style="color:#a6e22e">item</span><span style="color:#f92672">(</span>i<span style="color:#f92672">);</span>
                    String kind <span style="color:#f92672">=</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;kind&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                    List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> addTo <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>kind<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;src&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>            <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                        addTo <span style="color:#f92672">=</span> sources<span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>kind<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>  <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                        addTo <span style="color:#f92672">=</span> classes<span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>kind<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;lib&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>     <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                        addTo <span style="color:#f92672">=</span> libraries<span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>addTo <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        String path <span style="color:#f92672">=</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;path&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                        File folder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>projectDir<span style="color:#f92672">,</span> path<span style="color:#f92672">);</span>
                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>folder<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                            addTo<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>folder<span style="color:#f92672">);</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                log<span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Add in libraries that aren&#39;t specified in the .classpath file
</span><span style="color:#75715e"></span>        File libs <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">getDir</span><span style="color:#f92672">(),</span> LIBS_FOLDER<span style="color:#f92672">);</span><span style="color:#75715e">//添加 libs 目录下的jar文件
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>libs<span style="color:#f92672">.</span><span style="color:#a6e22e">isDirectory</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            File<span style="color:#f92672">[]</span> jars <span style="color:#f92672">=</span> libs<span style="color:#f92672">.</span><span style="color:#a6e22e">listFiles</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>jars <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>File jar <span style="color:#f92672">:</span> jars<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>endsWith<span style="color:#f92672">(</span>jar<span style="color:#f92672">.</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">(),</span> DOT_JAR<span style="color:#f92672">)</span>
                            <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>libraries<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>jar<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                        libraries<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>jar<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>classes<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            File folder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>projectDir<span style="color:#f92672">,</span> CLASS_FOLDER<span style="color:#f92672">);</span><span style="color:#75715e">//添加 bin/classes 文件夹
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>folder<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                classes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>folder<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span><span style="color:#75715e">//检查是否是maven项目，如果是的话编译得到的class文件是在 target/classes 目录下
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// Maven checks
</span><span style="color:#75715e"></span>                folder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>projectDir<span style="color:#f92672">,</span>
                        <span style="color:#e6db74">&#34;target&#34;</span> <span style="color:#f92672">+</span> File<span style="color:#f92672">.</span><span style="color:#a6e22e">separator</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;classes&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//$NON-NLS-1$ //$NON-NLS-2$
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>folder<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    classes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>folder<span style="color:#f92672">);</span>

                    <span style="color:#75715e">// If it&#39;s maven, also correct the source path, &#34;src&#34; works but
</span><span style="color:#75715e"></span>                    <span style="color:#75715e">// it&#39;s in a more specific subfolder
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sources<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span><span style="color:#75715e">//如果真的是maven项目的话，那么src/main/java目录是一个源码目录
</span><span style="color:#75715e"></span>                        File src <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>projectDir<span style="color:#f92672">,</span>
                                <span style="color:#e6db74">&#34;src&#34;</span> <span style="color:#f92672">+</span> File<span style="color:#f92672">.</span><span style="color:#a6e22e">separator</span>     <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                                <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;main&#34;</span> <span style="color:#f92672">+</span> File<span style="color:#f92672">.</span><span style="color:#a6e22e">separator</span>  <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                                <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;java&#34;</span><span style="color:#f92672">);</span>                 <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>src<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                            sources<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>src<span style="color:#f92672">);</span>
                        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                            src <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>projectDir<span style="color:#f92672">,</span> SRC_FOLDER<span style="color:#f92672">);</span>
                            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>src<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                                sources<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>src<span style="color:#f92672">);</span>
                            <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span>

                        <span style="color:#75715e">//有些class文件是自动生成的，存放在 target/generated-sources/r 目录下
</span><span style="color:#75715e"></span>                        File gen <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>projectDir<span style="color:#f92672">,</span>
                                <span style="color:#e6db74">&#34;target&#34;</span> <span style="color:#f92672">+</span> File<span style="color:#f92672">.</span><span style="color:#a6e22e">separator</span>                  <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                                <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;generated-sources&#34;</span> <span style="color:#f92672">+</span> File<span style="color:#f92672">.</span><span style="color:#a6e22e">separator</span>     <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                                <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;r&#34;</span><span style="color:#f92672">);</span>                                    <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>gen<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                            sources<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>gen<span style="color:#f92672">);</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Fallback, in case there is no Eclipse project metadata here
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sources<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            File src <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>projectDir<span style="color:#f92672">,</span> SRC_FOLDER<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>src<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                sources<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>src<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
            File gen <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>projectDir<span style="color:#f92672">,</span> GEN_FOLDER<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>gen<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                sources<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>gen<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        info <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ClassPathInfo<span style="color:#f92672">(</span>sources<span style="color:#f92672">,</span> classes<span style="color:#f92672">,</span> libraries<span style="color:#f92672">,</span> libraries<span style="color:#f92672">,</span> tests<span style="color:#f92672">);</span>
        mProjectInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> info<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> info<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>除了<code>ClassPathInfo</code>之外，还有很多其他的数据也会在<code>LintClient</code>中处理，例如本机的Android SDK的信息以及项目中使用的<code>buildtool</code>、<code>compileSdk</code>等。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> AndroidSdkHandler mSdk<span style="color:#f92672">;</span><span style="color:#75715e">//获取本机的 Android SDK 的相关信息
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Returns the SDK installation (used to look up platforms etc)
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @return the SDK if known
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Nullable</span>
<span style="color:#66d9ef">public</span> AndroidSdkHandler <span style="color:#a6e22e">getSdk</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mSdk <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        File sdkHome <span style="color:#f92672">=</span> getSdkHome<span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sdkHome <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            mSdk <span style="color:#f92672">=</span> AndroidSdkHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">(</span>sdkHome<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> mSdk<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">protected</span> IAndroidTarget<span style="color:#f92672">[]</span> mTargets<span style="color:#f92672">;</span><span style="color:#75715e">//获取 Android SDK 中已有的 Platform targets
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Returns all the {@link IAndroidTarget} versions installed in the user&#39;s SDK install
</span><span style="color:#75715e"> * area.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @return all the installed targets
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@NonNull</span>
<span style="color:#66d9ef">public</span> IAndroidTarget<span style="color:#f92672">[]</span> <span style="color:#a6e22e">getTargets</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span><span style="color:#75715e">//获取 Android SDK 中已有的 Platform targets
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mTargets <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        AndroidSdkHandler sdkHandler <span style="color:#f92672">=</span> getSdk<span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sdkHandler <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            ProgressIndicator logger <span style="color:#f92672">=</span> getRepositoryLogger<span style="color:#f92672">();</span>
            Collection<span style="color:#f92672">&lt;</span>IAndroidTarget<span style="color:#f92672">&gt;</span> targets <span style="color:#f92672">=</span> sdkHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">getAndroidTargetManager</span><span style="color:#f92672">(</span>logger<span style="color:#f92672">)</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">getTargets</span><span style="color:#f92672">(</span>logger<span style="color:#f92672">);</span>
            mTargets <span style="color:#f92672">=</span> targets<span style="color:#f92672">.</span><span style="color:#a6e22e">toArray</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> IAndroidTarget<span style="color:#f92672">[</span>targets<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()]);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            mTargets <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> IAndroidTarget<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> mTargets<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Returns the compile target to use for the given project
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param project the project in question
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @return the compile target to use to build the given project
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Nullable</span>
<span style="color:#66d9ef">public</span> IAndroidTarget <span style="color:#a6e22e">getCompileTarget</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> Project project<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//获取项目中使用的 compileSdkVersion
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> buildSdk <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getBuildSdk</span><span style="color:#f92672">();</span>
    IAndroidTarget<span style="color:#f92672">[]</span> targets <span style="color:#f92672">=</span> getTargets<span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> targets<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&gt;=</span> 0<span style="color:#f92672">;</span> i<span style="color:#f92672">--)</span> <span style="color:#f92672">{</span>
        IAndroidTarget target <span style="color:#f92672">=</span> targets<span style="color:#f92672">[</span>i<span style="color:#f92672">];</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>target<span style="color:#f92672">.</span><span style="color:#a6e22e">isPlatform</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> target<span style="color:#f92672">.</span><span style="color:#a6e22e">getVersion</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getApiLevel</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> buildSdk<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> target<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Returns the specific version of the build tools being used for the given project, if known
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param project the project in question
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @return the build tools version in use by the project, or null if not known
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Nullable</span>
<span style="color:#66d9ef">public</span> BuildToolInfo <span style="color:#a6e22e">getBuildTools</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> Project project<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//获取 build tools 的信息
</span><span style="color:#75715e"></span>    AndroidSdkHandler sdk <span style="color:#f92672">=</span> getSdk<span style="color:#f92672">();</span>
    <span style="color:#75715e">// Build systems like Eclipse and ant just use the latest available
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// build tools, regardless of project metadata. In Gradle, this
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// method is overridden to use the actual build tools specified in the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// project.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sdk <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        IAndroidTarget compileTarget <span style="color:#f92672">=</span> getCompileTarget<span style="color:#f92672">(</span>project<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>compileTarget <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> compileTarget<span style="color:#f92672">.</span><span style="color:#a6e22e">getBuildToolInfo</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> sdk<span style="color:#f92672">.</span><span style="color:#a6e22e">getLatestBuildTool</span><span style="color:#f92672">(</span>getRepositoryLogger<span style="color:#f92672">(),</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>最有意思的是，<strong>lint规则的查找过程也是在<code>LintClient</code>中定义的</strong>，下面的代码片段中包含两个重要的查找自定义lint规则的方法。从下面的代码片段中我们终于可以知道为什么放在<code>~/.android/lint</code>目录下的自定义lint规则的jar包能够被识别，指定<code>ANDROID_LINT_JARS</code>环境变量也能够识别，或者将<code>lint.jar</code>放在aar中也能够被识别！</p>
<ul>
<li><strong><code>findGlobalRuleJars</code>方法会在<code>~/.android/lint/</code>目录下找jar包，或者由<code>$ANDROID_LINT_JARS</code>环境变量指定的jar包，这些自定义的lint规则都是作用于全局的，也就是对于本机的所有Android工程都生效。</strong></li>
<li><strong><code>findRuleJars</code>方法是针对指定的project去查找自定义的lint规则，从源码来看，针对project自定义lint规则时只适用于基于Gradle的项目，包括普通的项目和库项目(library project)。</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Finds any custom lint rule jars that should be included for analysis,
</span><span style="color:#75715e"> * regardless of project.
</span><span style="color:#75715e"> * &lt;p&gt;
</span><span style="color:#75715e"> * The default implementation locates custom lint jars in ~/.android/lint/ and
</span><span style="color:#75715e"> * in $ANDROID_LINT_JARS
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @return a list of rule jars (possibly empty).
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MethodMayBeStatic&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">// Intentionally instance method so it can be overridden
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@NonNull</span>
<span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findGlobalRuleJars</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Look for additional detectors registered by the user, via
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// (1) an environment variable (useful for build servers etc), and
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// (2) via jar files in the .android/lint directory
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> files <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        String androidHome <span style="color:#f92672">=</span> AndroidLocation<span style="color:#f92672">.</span><span style="color:#a6e22e">getFolder</span><span style="color:#f92672">();</span><span style="color:#75715e">//在 .android/lint 目录下找
</span><span style="color:#75715e"></span>        File lint <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>androidHome <span style="color:#f92672">+</span> File<span style="color:#f92672">.</span><span style="color:#a6e22e">separator</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;lint&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>lint<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            File<span style="color:#f92672">[]</span> list <span style="color:#f92672">=</span> lint<span style="color:#f92672">.</span><span style="color:#a6e22e">listFiles</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>list <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>File jarFile <span style="color:#f92672">:</span> list<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>endsWith<span style="color:#f92672">(</span>jarFile<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(),</span> DOT_JAR<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>files <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                            files <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;();</span>
                        <span style="color:#f92672">}</span>
                        files<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>jarFile<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>AndroidLocation<span style="color:#f92672">.</span><span style="color:#a6e22e">AndroidLocationException</span> e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// Ignore -- no android dir, so no rules to load.
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//在环境变量 ANDROID_LINT_JARS 目录下找
</span><span style="color:#75715e"></span>    String lintClassPath <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">getenv</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ANDROID_LINT_JARS&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>lintClassPath <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>lintClassPath<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        String<span style="color:#f92672">[]</span> paths <span style="color:#f92672">=</span> lintClassPath<span style="color:#f92672">.</span><span style="color:#a6e22e">split</span><span style="color:#f92672">(</span>File<span style="color:#f92672">.</span><span style="color:#a6e22e">pathSeparator</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String path <span style="color:#f92672">:</span> paths<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            File jarFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>path<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>jarFile<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>files <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    files <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>files<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>jarFile<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                files<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>jarFile<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> files <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> files <span style="color:#f92672">:</span> Collections<span style="color:#f92672">.&lt;</span>File<span style="color:#f92672">&gt;</span>emptyList<span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Finds any custom lint rule jars that should be included for analysis
</span><span style="color:#75715e"> * in the given project
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param project the project to look up rule jars from
</span><span style="color:#75715e"> * @return a list of rule jars (possibly empty).
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MethodMayBeStatic&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">// Intentionally instance method so it can be overridden
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@NonNull</span>
<span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findRuleJars</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> Project project<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">isGradleProject</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">isLibrary</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span><span style="color:#75715e">//如果是gradle library项目，查找其中的 lint.jar 文件
</span><span style="color:#75715e"></span>            AndroidLibrary model <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getGradleLibraryModel</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>model <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                File lintJar <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span><span style="color:#a6e22e">getLintJar</span><span style="color:#f92672">();</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>lintJar<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">return</span> Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">singletonList</span><span style="color:#f92672">(</span>lintJar<span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">getSubset</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
          <span style="color:#75715e">//如果该项目有很多个子项目，那就检查当前variant下的依赖中的library project中是否包含了lint.jar
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// Probably just analyzing a single file: we still want to look for custom
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// rules applicable to the file
</span><span style="color:#75715e"></span>            List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> rules <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">final</span> Variant variant <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getCurrentVariant</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>variant <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                Collection<span style="color:#f92672">&lt;</span>AndroidLibrary<span style="color:#f92672">&gt;</span> libraries <span style="color:#f92672">=</span> variant<span style="color:#f92672">.</span><span style="color:#a6e22e">getMainArtifact</span><span style="color:#f92672">()</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">getDependencies</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getLibraries</span><span style="color:#f92672">();</span>
                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>AndroidLibrary library <span style="color:#f92672">:</span> libraries<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    File lintJar <span style="color:#f92672">=</span> library<span style="color:#f92672">.</span><span style="color:#a6e22e">getLintJar</span><span style="color:#f92672">();</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>lintJar<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>rules <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                            rules <span style="color:#f92672">=</span> Lists<span style="color:#f92672">.</span><span style="color:#a6e22e">newArrayListWithExpectedSize</span><span style="color:#f92672">(</span>4<span style="color:#f92672">);</span>
                        <span style="color:#f92672">}</span>
                        rules<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>lintJar<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>rules <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">return</span> rules<span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">getDir</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">().</span><span style="color:#a6e22e">endsWith</span><span style="color:#f92672">(</span>DOT_AAR<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//这种情况是project就是一个aar，查找其中的lint.jar文件
</span><span style="color:#75715e"></span>            File lintJar <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">getDir</span><span style="color:#f92672">(),</span> <span style="color:#e6db74">&#34;lint.jar&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>lintJar<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span> Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">singletonList</span><span style="color:#f92672">(</span>lintJar<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">emptyList</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>(2) <code>IssueRegistry</code>类用来管理需要检查的问题列表，其中还定义了三个特殊的问题：<code>PARSER_ERROR</code>表示lint解析文件时出错了；<code>LINT_ERROR</code>表示lint检查过程中出现错误，但不是用户代码的错误；<code>CANCELLED</code>表示用户取消了lint检查。除此之外，该类中还有一个重要方法<code>createDetectors</code>，用来根据指定的Configuration和Scope来创建检查器列表。<br>
<strong>通俗来讲，IssueRegistry就是lint要检查的问题集合。</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Registry which provides a list of checks to be performed on an Android project
</span><span style="color:#75715e"> * &lt;p&gt;
</span><span style="color:#75715e"> * &lt;b&gt;NOTE: This is not a public or final API; if you rely on this be prepared
</span><span style="color:#75715e"> * to adjust your code for the next tools release.&lt;/b&gt;
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Beta</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IssueRegistry</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">volatile</span> List<span style="color:#f92672">&lt;</span>Category<span style="color:#f92672">&gt;</span> sCategories<span style="color:#f92672">;</span><span style="color:#75715e">//问题的类别列表
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">volatile</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Issue<span style="color:#f92672">&gt;</span> sIdToIssue<span style="color:#f92672">;</span><span style="color:#75715e">//问题及其对应的issue
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Map<span style="color:#f92672">&lt;</span>EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;,</span> List<span style="color:#f92672">&lt;</span>Issue<span style="color:#f92672">&gt;&gt;</span> sScopeIssues <span style="color:#f92672">=</span> Maps<span style="color:#f92672">.</span><span style="color:#a6e22e">newHashMap</span><span style="color:#f92672">();</span><span style="color:#75715e">//某个特定的scope内的问题列表
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Issue reported by lint (not a specific detector) when it cannot even
</span><span style="color:#75715e">     * parse an XML file prior to analysis
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@NonNull</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Issue PARSER_ERROR <span style="color:#f92672">=</span> Issue<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">(</span>
            <span style="color:#e6db74">&#34;ParserError&#34;</span><span style="color:#f92672">,</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>            <span style="color:#e6db74">&#34;Parser Errors&#34;</span><span style="color:#f92672">,</span>
            <span style="color:#e6db74">&#34;Lint will ignore any files that contain fatal parsing errors. These may contain &#34;</span> <span style="color:#f92672">+</span>
            <span style="color:#e6db74">&#34;other errors, or contain code which affects issues in other files.&#34;</span><span style="color:#f92672">,</span>
            Category<span style="color:#f92672">.</span><span style="color:#a6e22e">CORRECTNESS</span><span style="color:#f92672">,</span>
            10<span style="color:#f92672">,</span>
            Severity<span style="color:#f92672">.</span><span style="color:#a6e22e">ERROR</span><span style="color:#f92672">,</span>
            DUMMY_IMPLEMENTATION<span style="color:#f92672">);</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Issue reported by lint for various other issues which prevents lint from
</span><span style="color:#75715e">     * running normally when it&#39;s not necessarily an error in the user&#39;s code base.
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@NonNull</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Issue LINT_ERROR <span style="color:#f92672">=</span> Issue<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">(</span>
        <span style="color:#e6db74">&#34;LintError&#34;</span><span style="color:#f92672">,</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>        <span style="color:#e6db74">&#34;Lint Failure&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;This issue type represents a problem running lint itself. Examples include &#34;</span> <span style="color:#f92672">+</span>
        <span style="color:#e6db74">&#34;failure to find bytecode for source files (which means certain detectors &#34;</span> <span style="color:#f92672">+</span>
        <span style="color:#e6db74">&#34;could not be run), parsing errors in lint configuration files, etc.&#34;</span> <span style="color:#f92672">+</span>
        <span style="color:#e6db74">&#34;\n&#34;</span> <span style="color:#f92672">+</span>
        <span style="color:#e6db74">&#34;These errors are not errors in your own code, but they are shown to make &#34;</span> <span style="color:#f92672">+</span>
        <span style="color:#e6db74">&#34;it clear that some checks were not completed.&#34;</span><span style="color:#f92672">,</span>
        Category<span style="color:#f92672">.</span><span style="color:#a6e22e">LINT</span><span style="color:#f92672">,</span>
        10<span style="color:#f92672">,</span>
        Severity<span style="color:#f92672">.</span><span style="color:#a6e22e">ERROR</span><span style="color:#f92672">,</span>
        DUMMY_IMPLEMENTATION<span style="color:#f92672">);</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Creates a list of detectors applicable to the given scope, and with the
</span><span style="color:#75715e">     * given configuration.
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @param client the client to report errors to
</span><span style="color:#75715e">     * @param configuration the configuration to look up which issues are
</span><span style="color:#75715e">     *            enabled etc from
</span><span style="color:#75715e">     * @param scope the scope for the analysis, to filter out detectors that
</span><span style="color:#75715e">     *            require wider analysis than is currently being performed
</span><span style="color:#75715e">     * @param scopeToDetectors an optional map which (if not null) will be
</span><span style="color:#75715e">     *            filled by this method to contain mappings from each scope to
</span><span style="color:#75715e">     *            the applicable detectors for that scope
</span><span style="color:#75715e">     * @return a list of new detector instances
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@NonNull</span>
    <span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Detector<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">createDetectors</span><span style="color:#f92672">(</span>
            <span style="color:#a6e22e">@NonNull</span> LintClient client<span style="color:#f92672">,</span>
            <span style="color:#a6e22e">@NonNull</span> Configuration configuration<span style="color:#f92672">,</span>
            <span style="color:#a6e22e">@NonNull</span> EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;</span> scope<span style="color:#f92672">,</span>
            <span style="color:#a6e22e">@Nullable</span> Map<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;&gt;</span> scopeToDetectors<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        List<span style="color:#f92672">&lt;</span>Issue<span style="color:#f92672">&gt;</span> issues <span style="color:#f92672">=</span> getIssuesForScope<span style="color:#f92672">(</span>scope<span style="color:#f92672">);</span><span style="color:#75715e">//获取该scope内的问题列表
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>issues<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">emptyList</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">//检查器列表detectorClasses和检查器到范围的映射关系detectorToScope
</span><span style="color:#75715e"></span>        Set<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Detector<span style="color:#f92672">&gt;&gt;</span> detectorClasses <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Detector<span style="color:#f92672">&gt;&gt;();</span>
        Map<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Detector<span style="color:#f92672">&gt;,</span> EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;&gt;</span> detectorToScope <span style="color:#f92672">=</span>
                <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Detector<span style="color:#f92672">&gt;,</span> EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;&gt;();</span>

        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Issue issue <span style="color:#f92672">:</span> issues<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//遍历问题列表，取出它们的Detector以及scope集合
</span><span style="color:#75715e"></span>            Implementation implementation <span style="color:#f92672">=</span> issue<span style="color:#f92672">.</span><span style="color:#a6e22e">getImplementation</span><span style="color:#f92672">();</span>
            Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Detector<span style="color:#f92672">&gt;</span> detectorClass <span style="color:#f92672">=</span> implementation<span style="color:#f92672">.</span><span style="color:#a6e22e">getDetectorClass</span><span style="color:#f92672">();</span>
            EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;</span> issueScope <span style="color:#f92672">=</span> implementation<span style="color:#f92672">.</span><span style="color:#a6e22e">getScope</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>detectorClasses<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>detectorClass<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">// Determine if the issue is enabled
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>configuration<span style="color:#f92672">.</span><span style="color:#a6e22e">isEnabled</span><span style="color:#f92672">(</span>issue<span style="color:#f92672">))</span> <span style="color:#f92672">{</span><span style="color:#75715e">//看configuration中是否开启了这个问题
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>

                <span style="color:#66d9ef">assert</span> implementation<span style="color:#f92672">.</span><span style="color:#a6e22e">isAdequate</span><span style="color:#f92672">(</span>scope<span style="color:#f92672">);</span> <span style="color:#75715e">// Ensured by getIssuesForScope above
</span><span style="color:#75715e"></span>                detectorClass <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span><span style="color:#a6e22e">replaceDetector</span><span style="color:#f92672">(</span>detectorClass<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">assert</span> detectorClass <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> issue<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">();</span>
                detectorClasses<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>detectorClass<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>

            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>scopeToDetectors <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;</span> s <span style="color:#f92672">=</span> detectorToScope<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>detectorClass<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>s <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    detectorToScope<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>detectorClass<span style="color:#f92672">,</span> issueScope<span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">containsAll</span><span style="color:#f92672">(</span>issueScope<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                    EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;</span> union <span style="color:#f92672">=</span> EnumSet<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>s<span style="color:#f92672">);</span>
                    union<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>issueScope<span style="color:#f92672">);</span>
                    detectorToScope<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>detectorClass<span style="color:#f92672">,</span> union<span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">//将detectorToScope转换成scopeToDetectors
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> detectors <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;(</span>detectorClasses<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Detector<span style="color:#f92672">&gt;</span> clz <span style="color:#f92672">:</span> detectorClasses<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                Detector detector <span style="color:#f92672">=</span> clz<span style="color:#f92672">.</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">();</span>
                detectors<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>detector<span style="color:#f92672">);</span>

                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>scopeToDetectors <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;</span> union <span style="color:#f92672">=</span> detectorToScope<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>clz<span style="color:#f92672">);</span>
                    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Scope s <span style="color:#f92672">:</span> union<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> list <span style="color:#f92672">=</span> scopeToDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>s<span style="color:#f92672">);</span>
                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>list <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                            list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;();</span>
                            scopeToDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>s<span style="color:#f92672">,</span> list<span style="color:#f92672">);</span>
                        <span style="color:#f92672">}</span>
                        list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>detector<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>

                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Throwable t<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                client<span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span>t<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Can&#39;t initialize detector %1$s&#34;</span><span style="color:#f92672">,</span> clz<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> detectors<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#f92672">...</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>IssueRegistry</code>类是一个抽象类，它只有一个抽象方法<code>getIssues</code>，返回需要检查的问题集合就行，所以特别容易实现。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> List<span style="color:#f92672">&lt;</span>Issue<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getIssues</span><span style="color:#f92672">();</span>
</code></pre></div><p><code>IssueRegistry</code>类有几个特别重要的实现子类，例如<code>BuiltinIssueRegistry</code>是系统内置的lint检查器集合，目前共有263个issue；<code>CompositeIssueRegistry</code>是一个将很多<code>IssueRegistry</code>中的issue整合到一起的IssueRegistry；还有一个很重要的用于加载jar文件中的<code>IssueRegistry</code>的类<code>JarFileIssueRegistry</code>，前面我们自定义的lint规则的jar包就是由它来解析并加载的。<br>
<strong>在自定义lint规则生成jar包时我们提到过要在<code>build.gradle</code>文件中给jar文件添加<code>Lint-Registry</code>的属性值，因为这里会进行检查，如果没有配置的话就不算是合法的lint包。此外，这个类使用了缓存机制来保存已经加载过的jar文件，所以也就导致了我们在自定义lint中出现的更改jar包但是Android Studio并没有更新lint规则的bug！</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * &lt;p&gt; An {@link IssueRegistry} for a custom lint rule jar file. The rule jar should provide a
</span><span style="color:#75715e"> * manifest entry with the key {@code Lint-Registry} and the value of the fully qualified name of an
</span><span style="color:#75715e"> * implementation of {@link IssueRegistry} (with a default constructor). &lt;/p&gt;
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * &lt;p&gt; NOTE: The custom issue registry should not extend this file; it should be a plain
</span><span style="color:#75715e"> * IssueRegistry! This file is used internally to wrap the given issue registry.&lt;/p&gt;
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JarFileIssueRegistry</span> <span style="color:#66d9ef">extends</span> IssueRegistry <span style="color:#f92672">{</span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Manifest constant for declaring an issue provider. Example: Lint-Registry:
</span><span style="color:#75715e">     * foo.bar.CustomIssueRegistry
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String MF_LINT_REGISTRY_OLD <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Lint-Registry&#34;</span><span style="color:#f92672">;</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String MF_LINT_REGISTRY <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Lint-Registry-v2&#34;</span><span style="color:#f92672">;</span> <span style="color:#75715e">//$NON-NLS-1$
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Map<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">,</span> SoftReference<span style="color:#f92672">&lt;</span>JarFileIssueRegistry<span style="color:#f92672">&gt;&gt;</span> sCache<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;</span>Issue<span style="color:#f92672">&gt;</span> myIssues<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> mHasLegacyDetectors<span style="color:#f92672">;</span>

    <span style="color:#75715e">/** True if one or more java detectors were found that use the old Lombok-based API */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hasLegacyDetectors</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> mHasLegacyDetectors<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@NonNull</span>
    <span style="color:#66d9ef">static</span> JarFileIssueRegistry <span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> LintClient client<span style="color:#f92672">,</span> <span style="color:#a6e22e">@NonNull</span> File jarFile<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ClassNotFoundException<span style="color:#f92672">,</span> IllegalAccessException<span style="color:#f92672">,</span>
            InstantiationException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sCache <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
           sCache <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">,</span> SoftReference<span style="color:#f92672">&lt;</span>JarFileIssueRegistry<span style="color:#f92672">&gt;&gt;();</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            SoftReference<span style="color:#f92672">&lt;</span>JarFileIssueRegistry<span style="color:#f92672">&gt;</span> reference <span style="color:#f92672">=</span> sCache<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>jarFile<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>reference <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                JarFileIssueRegistry registry <span style="color:#f92672">=</span> reference<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">();</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>registry <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">return</span> registry<span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Ensure that the scope-to-detector map doesn&#39;t return stale results
</span><span style="color:#75715e"></span>        IssueRegistry<span style="color:#f92672">.</span><span style="color:#a6e22e">reset</span><span style="color:#f92672">();</span>

        JarFileIssueRegistry registry <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JarFileIssueRegistry<span style="color:#f92672">(</span>client<span style="color:#f92672">,</span> jarFile<span style="color:#f92672">);</span>
        sCache<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>jarFile<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> SoftReference<span style="color:#f92672">&lt;</span>JarFileIssueRegistry<span style="color:#f92672">&gt;(</span>registry<span style="color:#f92672">));</span>
        <span style="color:#66d9ef">return</span> registry<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">JarFileIssueRegistry</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> LintClient client<span style="color:#f92672">,</span> <span style="color:#a6e22e">@NonNull</span> File file<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ClassNotFoundException<span style="color:#f92672">,</span> IllegalAccessException<span style="color:#f92672">,</span>
                    InstantiationException <span style="color:#f92672">{</span>
        myIssues <span style="color:#f92672">=</span> Lists<span style="color:#f92672">.</span><span style="color:#a6e22e">newArrayList</span><span style="color:#f92672">();</span>
        JarFile jarFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//noinspection IOResourceOpenedButNotSafelyClosed
</span><span style="color:#75715e"></span>            jarFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JarFile<span style="color:#f92672">(</span>file<span style="color:#f92672">);</span>
            Manifest manifest <span style="color:#f92672">=</span> jarFile<span style="color:#f92672">.</span><span style="color:#a6e22e">getManifest</span><span style="color:#f92672">();</span>
            Attributes attrs <span style="color:#f92672">=</span> manifest<span style="color:#f92672">.</span><span style="color:#a6e22e">getMainAttributes</span><span style="color:#f92672">();</span>
            Object object <span style="color:#f92672">=</span> attrs<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Attributes<span style="color:#f92672">.</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span>MF_LINT_REGISTRY<span style="color:#f92672">));</span>
            <span style="color:#66d9ef">boolean</span> isLegacy <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//检查jar包的MANIFEST.MF文件中是否配置了Lint-Registry-v2或者Lint-Registry属性值
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>object <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                object <span style="color:#f92672">=</span> attrs<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Attributes<span style="color:#f92672">.</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span>MF_LINT_REGISTRY_OLD<span style="color:#f92672">));</span>
                <span style="color:#75715e">//noinspection VariableNotUsedInsideIf
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>object <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#75715e">// It&#39;s an old rule. We don&#39;t yet conclude that
</span><span style="color:#75715e"></span>                    <span style="color:#75715e">//   mHasLegacyDetectors=true
</span><span style="color:#75715e"></span>                    <span style="color:#75715e">// because the lint checks may not be Java related.
</span><span style="color:#75715e"></span>                    isLegacy <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
            <span style="color:#75715e">//如果配置了的话，对应的值就是继承自IssueRegistry的类，我们需要去加载它
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>object <span style="color:#66d9ef">instanceof</span> String<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                String className <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>String<span style="color:#f92672">)</span> object<span style="color:#f92672">;</span>
                <span style="color:#75715e">// Make a class loader for this jar
</span><span style="color:#75715e"></span>                URL url <span style="color:#f92672">=</span> SdkUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">fileToUrl</span><span style="color:#f92672">(</span>file<span style="color:#f92672">);</span>
                ClassLoader loader <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span><span style="color:#a6e22e">createUrlClassLoader</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> URL<span style="color:#f92672">[]{</span>url<span style="color:#f92672">},</span>
                        JarFileIssueRegistry<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">());</span>
                Class<span style="color:#f92672">&lt;?&gt;</span> registryClass <span style="color:#f92672">=</span> Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span>className<span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> loader<span style="color:#f92672">);</span>
                IssueRegistry registry <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>IssueRegistry<span style="color:#f92672">)</span> registryClass<span style="color:#f92672">.</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">();</span>
                myIssues<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>registry<span style="color:#f92672">.</span><span style="color:#a6e22e">getIssues</span><span style="color:#f92672">());</span>

                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>isLegacy<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#75715e">// If it&#39;s an old registry, look through the issues to see if it
</span><span style="color:#75715e"></span>                    <span style="color:#75715e">// provides Java scanning and if so create the old style visitors
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Issue issue <span style="color:#f92672">:</span> myIssues<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;</span> scope <span style="color:#f92672">=</span> issue<span style="color:#f92672">.</span><span style="color:#a6e22e">getImplementation</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getScope</span><span style="color:#f92672">();</span>
                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>scope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">JAVA_FILE</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> scope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">JAVA_LIBRARIES</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">||</span> scope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">ALL_JAVA_FILES</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                            mHasLegacyDetectors <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>

                <span style="color:#75715e">//利用这个ClassLoader去加载jar包中的class
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>loader <span style="color:#66d9ef">instanceof</span> URLClassLoader<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    loadAndCloseURLClassLoader<span style="color:#f92672">(</span>client<span style="color:#f92672">,</span> file<span style="color:#f92672">,</span> <span style="color:#f92672">(</span>URLClassLoader<span style="color:#f92672">)</span>loader<span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                client<span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span>Severity<span style="color:#f92672">.</span><span style="color:#a6e22e">ERROR</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span>
                    <span style="color:#e6db74">&#34;Custom lint rule jar %1$s does not contain a valid registry manifest key &#34;</span> <span style="color:#f92672">+</span>
                    <span style="color:#e6db74">&#34;(%2$s).\n&#34;</span> <span style="color:#f92672">+</span>
                    <span style="color:#e6db74">&#34;Either the custom jar is invalid, or it uses an outdated API not supported &#34;</span> <span style="color:#f92672">+</span>
                    <span style="color:#e6db74">&#34;this lint client&#34;</span><span style="color:#f92672">,</span> file<span style="color:#f92672">.</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">(),</span> MF_LINT_REGISTRY<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>jarFile <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                jarFile<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#f92672">...</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>(3) <code>LintDriver</code>类是一个核心类，其中汇集了对Android工程或文件进行Lint检查所需的主要元素，包含了上面的<code>LintClient</code>和<code>IssueRegistry</code>等重要类，还有表示一次lint检查的请求<code>LintClient</code>以及监听lint检查过程的<code>LintListener</code>集合等数据。<br>
<strong>通俗来讲，LintDriver包含了一次lint检查时的所有信息，由它来进行lint检查的过程。</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Analyzes Android projects and files
</span><span style="color:#75715e"> * &lt;p&gt;
</span><span style="color:#75715e"> * &lt;b&gt;NOTE: This is not a public or final API; if you rely on this be prepared
</span><span style="color:#75715e"> * to adjust your code for the next tools release.&lt;/b&gt;
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Beta</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LintDriver</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Max number of passes to run through the lint runner if requested by
</span><span style="color:#75715e">     * {@link #requestRepeat}
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> MAX_PHASES <span style="color:#f92672">=</span> 3<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String SUPPRESS_LINT_VMSIG <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">+</span> SUPPRESS_LINT <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;;&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">/** Prefix used by the comment suppress mechanism in Studio/IntelliJ */</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String STUDIO_ID_PREFIX <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AndroidLint&#34;</span><span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> LintClient mClient<span style="color:#f92672">;</span><span style="color:#75715e">//检查器调用端，可能是android studio或者gradle或者cli
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> LintRequest mRequest<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> IssueRegistry mRegistry<span style="color:#f92672">;</span><span style="color:#75715e">//问题注册中心
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">volatile</span> <span style="color:#66d9ef">boolean</span> mCanceled<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;</span> mScope<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Detector<span style="color:#f92672">&gt;</span> mApplicableDetectors<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;&gt;</span> mScopeDetectors<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>LintListener<span style="color:#f92672">&gt;</span> mListeners<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> mPhase<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> mRepeatingDetectors<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> EnumSet<span style="color:#f92672">&lt;</span>Scope<span style="color:#f92672">&gt;</span> mRepeatScope<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Project<span style="color:#f92672">[]</span> mCurrentProjects<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Project mCurrentProject<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> mAbbreviating <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> mParserErrors<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">,</span>Object<span style="color:#f92672">&gt;</span> mProperties<span style="color:#f92672">;</span>
    <span style="color:#75715e">/** Whether we need to look for legacy (old Lombok-based Java API) detectors */</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> mRunCompatChecks <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">...</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>前面我们在<code>LintClient</code>中看到了lint工具是如何查找自定义的lint规则，但是并没有看到这些规则是如何注册到<code>IssueRegistry</code>上去的，而这个艰巨的任务实际上是在<code>LintDriver</code>中完成的，主要流程都在方法<code>registerCustomDetectors</code>中。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> Set<span style="color:#f92672">&lt;</span>Issue<span style="color:#f92672">&gt;</span> myCustomIssues<span style="color:#f92672">;</span><span style="color:#75715e">//自定义的lint规则集合
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* Returns true if the given issue is an issue that was loaded as a custom rule
</span><span style="color:#75715e">* (e.g. a 3rd-party library provided the detector, it&#39;s not built in)
</span><span style="color:#75715e">*
</span><span style="color:#75715e">* @param issue the issue to be looked up
</span><span style="color:#75715e">* @return true if this is a custom (non-builtin) check
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isCustomIssue</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> Issue issue<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//判断某个issue是否是自定义的issue
</span><span style="color:#75715e"></span>   <span style="color:#66d9ef">return</span> myCustomIssues <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> myCustomIssues<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>issue<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">//注册自定义的检查器，检查器来源于参数中指定的projects中
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">registerCustomDetectors</span><span style="color:#f92672">(</span>Collection<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> projects<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
   <span style="color:#75715e">// Look at the various projects, and if any of them provide a custom
</span><span style="color:#75715e"></span>   <span style="color:#75715e">// lint jar, &#34;add&#34; them (this will replace the issue registry with
</span><span style="color:#75715e"></span>   <span style="color:#75715e">// a CompositeIssueRegistry containing the original issue registry
</span><span style="color:#75715e"></span>   <span style="color:#75715e">// plus JarFileIssueRegistry instances for each lint jar
</span><span style="color:#75715e"></span>   Set<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> jarFiles <span style="color:#f92672">=</span> Sets<span style="color:#f92672">.</span><span style="color:#a6e22e">newHashSet</span><span style="color:#f92672">();</span>
   <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Project project <span style="color:#f92672">:</span> projects<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//遍历所有的project以及它们的library project，找出其中所有的lint.jar文件
</span><span style="color:#75715e"></span>       jarFiles<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>mClient<span style="color:#f92672">.</span><span style="color:#a6e22e">findRuleJars</span><span style="color:#f92672">(</span>project<span style="color:#f92672">));</span>
       <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Project library <span style="color:#f92672">:</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getAllLibraries</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
           jarFiles<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>mClient<span style="color:#f92672">.</span><span style="color:#a6e22e">findRuleJars</span><span style="color:#f92672">(</span>library<span style="color:#f92672">));</span>
       <span style="color:#f92672">}</span>
   <span style="color:#f92672">}</span>

   jarFiles<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>mClient<span style="color:#f92672">.</span><span style="color:#a6e22e">findGlobalRuleJars</span><span style="color:#f92672">());</span><span style="color:#75715e">//查找全局的自定义的lint规则的jar包
</span><span style="color:#75715e"></span>
   <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>jarFiles<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
       List<span style="color:#f92672">&lt;</span>IssueRegistry<span style="color:#f92672">&gt;</span> registries <span style="color:#f92672">=</span> Lists<span style="color:#f92672">.</span><span style="color:#a6e22e">newArrayListWithExpectedSize</span><span style="color:#f92672">(</span>jarFiles<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
       registries<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>mRegistry<span style="color:#f92672">);</span>
       <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>File jarFile <span style="color:#f92672">:</span> jarFiles<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
           <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
               JarFileIssueRegistry registry <span style="color:#f92672">=</span> JarFileIssueRegistry<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>mClient<span style="color:#f92672">,</span> jarFile<span style="color:#f92672">);</span>
               <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>registry<span style="color:#f92672">.</span><span style="color:#a6e22e">hasLegacyDetectors</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                   mRunCompatChecks <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
               <span style="color:#f92672">}</span>
               <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>myCustomIssues <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                   myCustomIssues <span style="color:#f92672">=</span> Sets<span style="color:#f92672">.</span><span style="color:#a6e22e">newHashSet</span><span style="color:#f92672">();</span>
               <span style="color:#f92672">}</span>
               myCustomIssues<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>registry<span style="color:#f92672">.</span><span style="color:#a6e22e">getIssues</span><span style="color:#f92672">());</span>
               registries<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>registry<span style="color:#f92672">);</span>
           <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Throwable e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
               mClient<span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span>e<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Could not load custom rule jar file %1$s&#34;</span><span style="color:#f92672">,</span> jarFile<span style="color:#f92672">);</span>
           <span style="color:#f92672">}</span>
       <span style="color:#f92672">}</span>
       <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>registries<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#75715e">// the first item is mRegistry itself
</span><span style="color:#75715e"></span>           mRegistry <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CompositeIssueRegistry<span style="color:#f92672">(</span>registries<span style="color:#f92672">);</span>
       <span style="color:#f92672">}</span>
   <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>LintDriver</code>还有一个重要的方法就是<code>analyze</code>，lint检查就是从这里正式开始的。其中的<code>mRequest</code>是<code>LintRequest</code>对象，类似HTTPRequest一样，表示一次lint检查的请求，它包含了这次lint检查的一些基本信息。其中还调用了<code>registerCustomDetectors</code>方法，这个方法就是用来注册那些自定义的lint规则的。此外，其中会遍历所有的project，然后调用<code>runExtraPhases</code>方法就该project进行lint检查。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/** Runs the driver to analyze the requested files */</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">analyze</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    mCanceled <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
    mScope <span style="color:#f92672">=</span> mRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">getScope</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">assert</span> mScope <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">ALL_RESOURCE_FILES</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span>
            mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">RESOURCE_FILE</span><span style="color:#f92672">);</span>

    Collection<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> projects<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        projects <span style="color:#f92672">=</span> mRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">getProjects</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>projects <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            projects <span style="color:#f92672">=</span> computeProjects<span style="color:#f92672">(</span>mRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">getFiles</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>CircularDependencyException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        mCurrentProject <span style="color:#f92672">=</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getProject</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCurrentProject <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            Location location <span style="color:#f92672">=</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getLocation</span><span style="color:#f92672">();</span>
            File file <span style="color:#f92672">=</span> location <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> location<span style="color:#f92672">.</span><span style="color:#a6e22e">getFile</span><span style="color:#f92672">()</span> <span style="color:#f92672">:</span> mCurrentProject<span style="color:#f92672">.</span><span style="color:#a6e22e">getDir</span><span style="color:#f92672">();</span>
            Context context <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Context<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> mCurrentProject<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> file<span style="color:#f92672">);</span>
            context<span style="color:#f92672">.</span><span style="color:#a6e22e">report</span><span style="color:#f92672">(</span>IssueRegistry<span style="color:#f92672">.</span><span style="color:#a6e22e">LINT_ERROR</span><span style="color:#f92672">,</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getLocation</span><span style="color:#f92672">(),</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
            mCurrentProject <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>projects<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        mClient<span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;No projects found for %1$s&#34;</span><span style="color:#f92672">,</span> mRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">getFiles</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    registerCustomDetectors<span style="color:#f92672">(</span>projects<span style="color:#f92672">);</span><span style="color:#75715e">//注册自定义的lint检查器
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mScope <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//如果范围为空，那么就根据projects来推断范围
</span><span style="color:#75715e"></span>        mScope <span style="color:#f92672">=</span> Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">infer</span><span style="color:#f92672">(</span>projects<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    fireEvent<span style="color:#f92672">(</span>EventType<span style="color:#f92672">.</span><span style="color:#a6e22e">STARTING</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span><span style="color:#75715e">//fireEvent用于触发相应的事件，通知LintListener
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Project project <span style="color:#f92672">:</span> projects<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        mPhase <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span>
        Project main <span style="color:#f92672">=</span> mRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">getMainProject</span><span style="color:#f92672">(</span>project<span style="color:#f92672">);</span>
        <span style="color:#75715e">// The set of available detectors varies between projects
</span><span style="color:#75715e"></span>        computeDetectors<span style="color:#f92672">(</span>project<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mApplicableDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// No detectors enabled in this project: skip it
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        checkProject<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        runExtraPhases<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    fireEvent<span style="color:#f92672">(</span>mCanceled <span style="color:#f92672">?</span> EventType<span style="color:#f92672">.</span><span style="color:#a6e22e">CANCELED</span> <span style="color:#f92672">:</span> EventType<span style="color:#f92672">.</span><span style="color:#a6e22e">COMPLETED</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>runExtraPhases</code>方法中会调用<code>checkProject</code>方法去对指定的project进行lint检查，其中调用了另一个核心方法<code>runFileDetectors</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">checkProject</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> Project project<span style="color:#f92672">,</span> <span style="color:#a6e22e">@NonNull</span> Project main<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    File projectDir <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getDir</span><span style="color:#f92672">();</span>

    Context projectContext <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Context<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> project<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> projectDir<span style="color:#f92672">);</span>
    fireEvent<span style="color:#f92672">(</span>EventType<span style="color:#f92672">.</span><span style="color:#a6e22e">SCANNING_PROJECT</span><span style="color:#f92672">,</span> projectContext<span style="color:#f92672">);</span>

    List<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> allLibraries <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getAllLibraries</span><span style="color:#f92672">();</span>
    Set<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> allProjects <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;(</span>allLibraries<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> 1<span style="color:#f92672">);</span>
    allProjects<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>project<span style="color:#f92672">);</span>
    allProjects<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>allLibraries<span style="color:#f92672">);</span>
    mCurrentProjects <span style="color:#f92672">=</span> allProjects<span style="color:#f92672">.</span><span style="color:#a6e22e">toArray</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Project<span style="color:#f92672">[</span>allProjects<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()]);</span>

    mCurrentProject <span style="color:#f92672">=</span> project<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Detector check <span style="color:#f92672">:</span> mApplicableDetectors<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        check<span style="color:#f92672">.</span><span style="color:#a6e22e">beforeCheckProject</span><span style="color:#f92672">(</span>projectContext<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">assert</span> mCurrentProject <span style="color:#f92672">==</span> project<span style="color:#f92672">;</span>
    runFileDetectors<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">checkSingleFile</span><span style="color:#f92672">(</span>mScope<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> libraries <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getAllLibraries</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Project library <span style="color:#f92672">:</span> libraries<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            Context libraryContext <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Context<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> library<span style="color:#f92672">,</span> project<span style="color:#f92672">,</span> projectDir<span style="color:#f92672">);</span>
            fireEvent<span style="color:#f92672">(</span>EventType<span style="color:#f92672">.</span><span style="color:#a6e22e">SCANNING_LIBRARY_PROJECT</span><span style="color:#f92672">,</span> libraryContext<span style="color:#f92672">);</span>
            mCurrentProject <span style="color:#f92672">=</span> library<span style="color:#f92672">;</span>

            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Detector check <span style="color:#f92672">:</span> mApplicableDetectors<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                check<span style="color:#f92672">.</span><span style="color:#a6e22e">beforeCheckLibraryProject</span><span style="color:#f92672">(</span>libraryContext<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
            <span style="color:#66d9ef">assert</span> mCurrentProject <span style="color:#f92672">==</span> library<span style="color:#f92672">;</span>
            runFileDetectors<span style="color:#f92672">(</span>library<span style="color:#f92672">,</span> main<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>

            <span style="color:#66d9ef">assert</span> mCurrentProject <span style="color:#f92672">==</span> library<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Detector check <span style="color:#f92672">:</span> mApplicableDetectors<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                check<span style="color:#f92672">.</span><span style="color:#a6e22e">afterCheckLibraryProject</span><span style="color:#f92672">(</span>libraryContext<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    mCurrentProject <span style="color:#f92672">=</span> project<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Detector check <span style="color:#f92672">:</span> mApplicableDetectors<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        check<span style="color:#f92672">.</span><span style="color:#a6e22e">afterCheckProject</span><span style="color:#f92672">(</span>projectContext<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        mClient<span style="color:#f92672">.</span><span style="color:#a6e22e">report</span><span style="color:#f92672">(</span>
            projectContext<span style="color:#f92672">,</span>
            <span style="color:#75715e">// Must provide an issue since API guarantees that the issue parameter
</span><span style="color:#75715e"></span>            IssueRegistry<span style="color:#f92672">.</span><span style="color:#a6e22e">CANCELLED</span><span style="color:#f92672">,</span>
            Severity<span style="color:#f92672">.</span><span style="color:#a6e22e">INFORMATIONAL</span><span style="color:#f92672">,</span>
            Location<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">getDir</span><span style="color:#f92672">()),</span>
            <span style="color:#e6db74">&#34;Lint canceled by user&#34;</span><span style="color:#f92672">,</span> TextFormat<span style="color:#f92672">.</span><span style="color:#a6e22e">RAW</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    mCurrentProjects <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>方法<code>runFileDetectors</code>的作用就是对文件进行lint检查，上一篇我们提到过lint检查的顺序，从下面的代码我们也可以看出检查的顺序依次是<code>Manifest文件 =&gt; Resource文件 =&gt; Java源码文件 =&gt; Java Class文件 =&gt; Gradle文件 =&gt; Generic文件 =&gt; Proguard文件 =&gt; Property文件</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">runFileDetectors</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> Project project<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> Project main<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Look up manifest information (but not for library projects)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">isAndroidProject</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
      <span style="color:#75715e">//如果是Android项目的话，使用XmlParser去读取Manifest.xml文件的信息
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>File manifestFile <span style="color:#f92672">:</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getManifestFiles</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            XmlParser parser <span style="color:#f92672">=</span> mClient<span style="color:#f92672">.</span><span style="color:#a6e22e">getXmlParser</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>parser <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                XmlContext context <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> XmlContext<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> project<span style="color:#f92672">,</span> main<span style="color:#f92672">,</span> manifestFile<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> parser<span style="color:#f92672">);</span>
                context<span style="color:#f92672">.</span><span style="color:#a6e22e">document</span> <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span><span style="color:#a6e22e">parseXml</span><span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>context<span style="color:#f92672">.</span><span style="color:#a6e22e">document</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                        project<span style="color:#f92672">.</span><span style="color:#a6e22e">readManifest</span><span style="color:#f92672">(</span>context<span style="color:#f92672">.</span><span style="color:#a6e22e">document</span><span style="color:#f92672">);</span>

                        <span style="color:#75715e">//执行lint检查时会先获取Scope.MANIFEST下的所有detector
</span><span style="color:#75715e"></span>                        <span style="color:#75715e">//然后创建ResourceVisitor去对文件进行lint检查
</span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((!</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">isLibrary</span><span style="color:#f92672">()</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>main <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>
                                <span style="color:#f92672">&amp;&amp;</span> main<span style="color:#f92672">.</span><span style="color:#a6e22e">isMergingManifests</span><span style="color:#f92672">()))</span>
                                <span style="color:#f92672">&amp;&amp;</span> mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">MANIFEST</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                            List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> detectors <span style="color:#f92672">=</span> mScopeDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">MANIFEST</span><span style="color:#f92672">);</span>
                            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>detectors <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                                ResourceVisitor v <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ResourceVisitor<span style="color:#f92672">(</span>parser<span style="color:#f92672">,</span> detectors<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
                                fireEvent<span style="color:#f92672">(</span>EventType<span style="color:#f92672">.</span><span style="color:#a6e22e">SCANNING_FILE</span><span style="color:#f92672">,</span> context<span style="color:#f92672">);</span>
                                v<span style="color:#f92672">.</span><span style="color:#a6e22e">visitFile</span><span style="color:#f92672">(</span>context<span style="color:#f92672">,</span> manifestFile<span style="color:#f92672">);</span>
                            <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
                      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>context<span style="color:#f92672">.</span><span style="color:#a6e22e">document</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#75715e">// else: freed by XmlVisitor above
</span><span style="color:#75715e"></span>                          parser<span style="color:#f92672">.</span><span style="color:#a6e22e">dispose</span><span style="color:#f92672">(</span>context<span style="color:#f92672">,</span> context<span style="color:#f92672">.</span><span style="color:#a6e22e">document</span><span style="color:#f92672">);</span>
                      <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">//检查资源文件
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Process both Scope.RESOURCE_FILE and Scope.ALL_RESOURCE_FILES detectors together
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// in a single pass through the resource directories.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">ALL_RESOURCE_FILES</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">||</span> mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">RESOURCE_FILE</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">||</span> mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">RESOURCE_FOLDER</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">||</span> mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">BINARY_RESOURCE_FILE</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> dirChecks <span style="color:#f92672">=</span> mScopeDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">RESOURCE_FOLDER</span><span style="color:#f92672">);</span>
            List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> binaryChecks <span style="color:#f92672">=</span> mScopeDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">BINARY_RESOURCE_FILE</span><span style="color:#f92672">);</span>
            List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> checks <span style="color:#f92672">=</span> union<span style="color:#f92672">(</span>mScopeDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">RESOURCE_FILE</span><span style="color:#f92672">),</span>
                    mScopeDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">ALL_RESOURCE_FILES</span><span style="color:#f92672">));</span>
            <span style="color:#66d9ef">boolean</span> haveXmlChecks <span style="color:#f92672">=</span> checks <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>checks<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">();</span>
            List<span style="color:#f92672">&lt;</span>ResourceXmlDetector<span style="color:#f92672">&gt;</span> xmlDetectors<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>haveXmlChecks<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                xmlDetectors <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>ResourceXmlDetector<span style="color:#f92672">&gt;(</span>checks<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Detector detector <span style="color:#f92672">:</span> checks<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>detector <span style="color:#66d9ef">instanceof</span> ResourceXmlDetector<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        xmlDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">((</span>ResourceXmlDetector<span style="color:#f92672">)</span> detector<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
                haveXmlChecks <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>xmlDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">();</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                xmlDetectors <span style="color:#f92672">=</span> Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">emptyList</span><span style="color:#f92672">();</span>
            <span style="color:#f92672">}</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>haveXmlChecks
                    <span style="color:#f92672">||</span> dirChecks <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>dirChecks<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">()</span>
                    <span style="color:#f92672">||</span> binaryChecks <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>binaryChecks<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> files <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getSubset</span><span style="color:#f92672">();</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>files <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    checkIndividualResources<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">,</span> xmlDetectors<span style="color:#f92672">,</span> dirChecks<span style="color:#f92672">,</span>
                            binaryChecks<span style="color:#f92672">,</span> files<span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                    List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> resourceFolders <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceFolders</span><span style="color:#f92672">();</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>resourceFolders<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>File res <span style="color:#f92672">:</span> resourceFolders<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                            checkResFolder<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">,</span> res<span style="color:#f92672">,</span> xmlDetectors<span style="color:#f92672">,</span> dirChecks<span style="color:#f92672">,</span>
                                    binaryChecks<span style="color:#f92672">);</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//检查java文件
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">JAVA_FILE</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">ALL_JAVA_FILES</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> checks <span style="color:#f92672">=</span> union<span style="color:#f92672">(</span>mScopeDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">JAVA_FILE</span><span style="color:#f92672">),</span>
                mScopeDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">ALL_JAVA_FILES</span><span style="color:#f92672">));</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>checks <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>checks<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> files <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getSubset</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>files <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                checkIndividualJavaFiles<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">,</span> checks<span style="color:#f92672">,</span> files<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> sourceFolders <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getJavaSourceFolders</span><span style="color:#f92672">();</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">TEST_SOURCES</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                    List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> testFolders <span style="color:#f92672">=</span> project<span style="color:#f92672">.</span><span style="color:#a6e22e">getTestSourceFolders</span><span style="color:#f92672">();</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>testFolders<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                        List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> combined <span style="color:#f92672">=</span> Lists<span style="color:#f92672">.</span><span style="color:#a6e22e">newArrayListWithExpectedSize</span><span style="color:#f92672">(</span>
                                sourceFolders<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> testFolders<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
                        combined<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>sourceFolders<span style="color:#f92672">);</span>
                        combined<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>testFolders<span style="color:#f92672">);</span>
                        sourceFolders <span style="color:#f92672">=</span> combined<span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>

                checkJava<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">,</span> sourceFolders<span style="color:#f92672">,</span> checks<span style="color:#f92672">);</span>

            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//检查class文件
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">CLASS_FILE</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">||</span> mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">ALL_CLASS_FILES</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">||</span> mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">JAVA_LIBRARIES</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        checkClasses<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//检查gradle文件
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">GRADLE_FILE</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        checkBuildScripts<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//检查其他的Generic文件
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">OTHER</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> checks <span style="color:#f92672">=</span> mScopeDetectors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">OTHER</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>checks <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            OtherFileVisitor visitor <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> OtherFileVisitor<span style="color:#f92672">(</span>checks<span style="color:#f92672">);</span>
            visitor<span style="color:#f92672">.</span><span style="color:#a6e22e">scan</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> project<span style="color:#f92672">,</span> main<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//检查proguard文件
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>project <span style="color:#f92672">==</span> main <span style="color:#f92672">&amp;&amp;</span> mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">PROGUARD_FILE</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span>
            project<span style="color:#f92672">.</span><span style="color:#a6e22e">isAndroidProject</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        checkProGuard<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//检查property文件
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>project <span style="color:#f92672">==</span> main <span style="color:#f92672">&amp;&amp;</span> mScope<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Scope<span style="color:#f92672">.</span><span style="color:#a6e22e">PROPERTY_FILE</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        checkProperties<span style="color:#f92672">(</span>project<span style="color:#f92672">,</span> main<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>下面我们看下Java文件是如何进行lint检查的，我们在下一篇将会详细介绍这部分代码的实现细节。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">checkIndividualJavaFiles</span><span style="color:#f92672">(</span><span style="color:#75715e">//检查单个的Java文件
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">@NonNull</span> Project project<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@Nullable</span> Project main<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@NonNull</span> List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> checks<span style="color:#f92672">,</span>
        <span style="color:#a6e22e">@NonNull</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> files<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    JavaParser javaParser <span style="color:#f92672">=</span> mClient<span style="color:#f92672">.</span><span style="color:#a6e22e">getJavaParser</span><span style="color:#f92672">(</span>project<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>javaParser <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        mClient<span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;No java parser provided to lint: not running Java checks&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    List<span style="color:#f92672">&lt;</span>JavaContext<span style="color:#f92672">&gt;</span> contexts <span style="color:#f92672">=</span> Lists<span style="color:#f92672">.</span><span style="color:#a6e22e">newArrayListWithExpectedSize</span><span style="color:#f92672">(</span>files<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>File file <span style="color:#f92672">:</span> files<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>file<span style="color:#f92672">.</span><span style="color:#a6e22e">isFile</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> file<span style="color:#f92672">.</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">().</span><span style="color:#a6e22e">endsWith</span><span style="color:#f92672">(</span>DOT_JAVA<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            contexts<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> JavaContext<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> project<span style="color:#f92672">,</span> main<span style="color:#f92672">,</span> file<span style="color:#f92672">,</span> javaParser<span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>contexts<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    visitJavaFiles<span style="color:#f92672">(</span>checks<span style="color:#f92672">,</span> javaParser<span style="color:#f92672">,</span> contexts<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">//访问java文件，进行lint检查
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">visitJavaFiles</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> checks<span style="color:#f92672">,</span> JavaParser javaParser<span style="color:#f92672">,</span>
        List<span style="color:#f92672">&lt;</span>JavaContext<span style="color:#f92672">&gt;</span> contexts<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Temporary: we still have some builtin checks that aren&#39;t migrated to
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// PSI. Until that&#39;s complete, remove them from the list here
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//List&lt;Detector&gt; scanners = checks;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//当前新版的Java检查器都是实现了JavaPsiScanner接口，由它可以创建JavaPsiVisitor
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> scanners <span style="color:#f92672">=</span> Lists<span style="color:#f92672">.</span><span style="color:#a6e22e">newArrayListWithCapacity</span><span style="color:#f92672">(</span>checks<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Detector detector <span style="color:#f92672">:</span> checks<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>detector <span style="color:#66d9ef">instanceof</span> Detector<span style="color:#f92672">.</span><span style="color:#a6e22e">JavaPsiScanner</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            scanners<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>detector<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    JavaPsiVisitor visitor <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JavaPsiVisitor<span style="color:#f92672">(</span>javaParser<span style="color:#f92672">,</span> scanners<span style="color:#f92672">);</span>
    visitor<span style="color:#f92672">.</span><span style="color:#a6e22e">prepare</span><span style="color:#f92672">(</span>contexts<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>JavaContext context <span style="color:#f92672">:</span> contexts<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        fireEvent<span style="color:#f92672">(</span>EventType<span style="color:#f92672">.</span><span style="color:#a6e22e">SCANNING_FILE</span><span style="color:#f92672">,</span> context<span style="color:#f92672">);</span>
        visitor<span style="color:#f92672">.</span><span style="color:#a6e22e">visitFile</span><span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    visitor<span style="color:#f92672">.</span><span style="color:#a6e22e">dispose</span><span style="color:#f92672">();</span>

    <span style="color:#75715e">//下面是为了兼容以前版本的Java检查器而做的检查，它会创建JavaScanner以及JavaVisitor去对文件进行检查
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Only if the user is using some custom lint rules that haven&#39;t been updated
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// yet noinspection ConstantConditions
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mRunCompatChecks<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// Filter the checks to only those that implement JavaScanner
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>Detector<span style="color:#f92672">&gt;</span> filtered <span style="color:#f92672">=</span> Lists<span style="color:#f92672">.</span><span style="color:#a6e22e">newArrayListWithCapacity</span><span style="color:#f92672">(</span>checks<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Detector detector <span style="color:#f92672">:</span> checks<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>detector <span style="color:#66d9ef">instanceof</span> Detector<span style="color:#f92672">.</span><span style="color:#a6e22e">JavaScanner</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                filtered<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>detector<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>filtered<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> detectorNames <span style="color:#f92672">=</span> Lists<span style="color:#f92672">.</span><span style="color:#a6e22e">newArrayListWithCapacity</span><span style="color:#f92672">(</span>filtered<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Detector detector <span style="color:#f92672">:</span> filtered<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                detectorNames<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>detector<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
            <span style="color:#f92672">}</span>
            Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">sort</span><span style="color:#f92672">(</span>detectorNames<span style="color:#f92672">);</span>
            JavaVisitor oldVisitor <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JavaVisitor<span style="color:#f92672">(</span>javaParser<span style="color:#f92672">,</span> filtered<span style="color:#f92672">);</span>

            oldVisitor<span style="color:#f92672">.</span><span style="color:#a6e22e">prepare</span><span style="color:#f92672">(</span>contexts<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>JavaContext context <span style="color:#f92672">:</span> contexts<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                fireEvent<span style="color:#f92672">(</span>EventType<span style="color:#f92672">.</span><span style="color:#a6e22e">SCANNING_FILE</span><span style="color:#f92672">,</span> context<span style="color:#f92672">);</span>
                oldVisitor<span style="color:#f92672">.</span><span style="color:#a6e22e">visitFile</span><span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mCanceled<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
            oldVisitor<span style="color:#f92672">.</span><span style="color:#a6e22e">dispose</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>未完待续&hellip;</p>
    </section>

    <footer class="post-footer">
      
        <figure class="author-image">
            <a class="img" href="https://hujiaweibujidao.github.io/" style="background-image: url(https://hujiaweibujidao.github.io/images/logo.gif)"><span class="hidden">hujiawei's Picture</span></a>
        </figure>
      

      





<section class="author" style="width:100%;">
  <div class="author-meta" style="width:100%;text-align:center;">
    <span class="author-location icon-user"> Hujiawei is a mobile developer</span>
    <span class="author-location icon-location"> Guangdong, China</span>
    <span class="author-link icon-link"><a href="https://hujiaweibujidao.github.io/"> https://hujiaweibujidao.github.io/</a></span>
    

    
  </div>
  <br/>
</section>


      
        <aside class="read-next">
  
      <span class="readmore-prev readmore-meta">PREV: <a href="https://hujiaweibujidao.github.io/blog/2016/11/19/lint-tool-analysis-3/"><h4>Lint Tool Analysis (3)</h4></a></span>
      
  

  
      <span class="readmore-next readmore-meta">NEXT: <a href="https://hujiaweibujidao.github.io/blog/2016/11/17/lint-tool-analysis-1/"><h4>Lint Tool Analysis (1)</h4></a></span>
      
  
</aside>
<br/>

      
      
      
    </footer>
</article>

</main>

    <footer class="site-footer clearfix">
        <a id="gotop" class="icon-arrow-up" href="#" title="back to top"></a>

        <section class="copyright"><a href="">Hujiawei Bujidao. </a> All rights reserved &copy; 2013 - 2020</section>
        
        <section class="poweredby">Proudly generated by <a href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme &nbsp;
            
            <script type="text/javascript">
                var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
                document.write(unescape("%3Cspan id='cnzz_stat_icon_1000165127'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1000165127%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
            </script>
        </section>
        
    </footer>
  </div> 
    <script type="text/javascript" src="https://hujiaweibujidao.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="https://hujiaweibujidao.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://hujiaweibujidao.github.io/js/index.js"></script>

    
    
    
    

    
</body>
</html>

